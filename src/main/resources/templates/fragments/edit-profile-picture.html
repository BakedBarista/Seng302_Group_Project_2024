<img
    class="profile-picture-large"
    th:src="@{'/users/' + ${userId} + '/profile-picture'}"
    width="100"
    height="100"
    alt="profile picture"
/>

<form
    th:action="@{'/users/profile-picture'}"
    method="post"
    enctype="multipart/form-data"
    id="profilePictureForm"
>
    <label class="form-group link-text" tabindex="0">
        Edit Profile Picture
        <input type="file" name="file" id="profilePictureInput" />
    </label>
    <span id="profilePictureError" class="error" style="display: none"></span>
</form>

<script>
    (function () {
        /** @type {HTMLFormElement} */
        const profilePictureForm =
            document.getElementById("profilePictureForm");
        /** @type {HTMLInputElement} */
        const profilePictureInput = document.getElementById(
            "profilePictureInput"
        );
        /** @type {HTMLSpanElement} */
        const profilePictureError = document.getElementById(
            "profilePictureError"
        );

        const VALID_MIME_TYPES = ["image/png", "image/jpeg", "image/svg+xml"];

        profilePictureForm.addEventListener("keydown", (ev) => {
            if (ev.key === "Enter") {
                profilePictureInput.click();
            }
        });

        profilePictureInput.addEventListener("change", (ev) => {
            const file = profilePictureInput.files[0];
            if (!file) {
                return;
            }

            if (!VALID_MIME_TYPES.includes(file.type)) {
                profilePictureError.style.display = "block";
                profilePictureError.textContent =
                    "Image must be of type png, jpg or svg";
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                profilePictureError.style.display = "block";
                profilePictureError.textContent =
                    "File size must be less than 10MB";
                return;
            }

            profilePictureForm.submit();
        });
    })();
</script>
