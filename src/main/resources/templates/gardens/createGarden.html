<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="">
    <head>
        <meta http-equiv="Content-Type" context="text/html; charset=UTF-8">

        <title>Create New Garden</title>
        <th:block th:insert="~{fragments/general.html :: headerfiles}"></th:block>

        <meta name="_importImage" th:content="${importImage}" />
        <meta name="_importImageType" th:content="${importImageType}" />
    </head>
    <body>
        <nav th:replace="~{fragments/navbar :: navbar}"></nav>
        <main class="main-container" style="max-width: 1000px">
            <div class="card p-5">
                <h2 class="mb-3">Create Garden</h2>
            
                <div th:replace="~{fragments/garden-form :: garden-form(action='/gardens/create', imgSrc='/img/default-plant.svg', cancelUrl='/')}"></div>
            </div>
        </main>
        <th:block th:insert="~{fragments/general.html :: bs-scripts}"></th:block>
    </body>

    <script th:src="@{/js/plantImageErrorChecking.js}"></script>

    <script>
        const importImage = getMeta('_importImage');
        const importImageType = getMeta('_importImageType');
    
        if (importImage) {
            document.getElementById('preview').src = 'data:' + importImageType + ';base64,' + importImage;
    
            const imageInput = document.getElementById('image');
    
            // Create a new file object
            const fileContent = [atob(importImage)];
            const fileName = 'file.' + importImageType.split('/')[1];
            const file = new File(fileContent, fileName);
            file.type = importImageType;
    
            // Create a data transfer object. Similar to what you get from a `drop` event as `event.dataTransfer`
            const dataTransfer = new DataTransfer();
    
            // Add your file to the file list of the object
            dataTransfer.items.add(file);
    
            // Save the file list to a new variable
            const fileList = dataTransfer.files;
    
            // Set your input `files` to the file list
            imageInput.files = fileList;
        }
    </script>
</html>
